# HTTP 버전별 차이와 성능 개선

## HTTP 버전별 비교표

| 구분 | HTTP/1.0 | HTTP/1.1 | HTTP/2 | HTTP/3 |
|------|----------|-----------|---------|---------|
| **연결 방식** | 요청마다 새 연결 | Keep-Alive (지속 연결) | 멀티플렉싱 | 멀티플렉싱 + 병렬 스트림 |
| **전송 프로토콜** | TCP | TCP | TCP | UDP (QUIC) |
| **보안** | 선택적 | 선택적 | TLS 권장 | TLS 필수 |
| **데이터 형식** | 텍스트 | 텍스트 | 바이너리 프레이밍 | 바이너리 프레이밍 |
| **헤더 압축** | 없음 | 없음 | HPACK 압축 | QPACK 압축 |
| **주요 문제** | 연결 오버헤드 | HOL Blocking | TCP HOL Blocking | - |

## 주요 개념 설명

### HOL Blocking (Head of Line Blocking)
- **정의**: 앞선 요청이 지연되면 뒤의 요청들도 함께 대기하는 현상
- **HTTP/1.1**: 하나의 TCP 연결에서 순차 처리로 인한 대기
- **HTTP/2**: TCP 레벨에서 여전히 발생 (패킷 유실 시 전체 지연)
- **HTTP/3**: UDP 기반 QUIC으로 완전히 해결

### 성능 개선 기술
- **멀티플렉싱**: 하나의 연결로 여러 요청/응답 동시 처리
- **바이너리 프레이밍**: 텍스트 대신 바이너리로 효율적 전송
- **헤더 압축**: 중복 헤더 정보 압축하여 전송량 감소
- **QUIC**: UDP 기반 빠른 연결 설정 + 내장 암호화

# IPS와 네트워크 보안 구조

## IPS (Intrusion Prevention System)
- **정의**: 침입 방지 시스템, 네트워크 트래픽을 실시간으로 분석하여 악성 활동을 탐지하고 차단
- **동작 방식**: 패킷을 검사하여 알려진 공격 패턴이나 비정상적인 행동을 감지하면 즉시 차단

## 방화벽 vs WAF 차이점

| 구분 | 방화벽(Firewall) | WAF(Web Application Firewall) |
|------|------------------|--------------------------------|
| **동작 계층** | L3-L4 (네트워크/전송 계층) | L7 (애플리케이션 계층) |
| **검사 대상** | IP 주소, 포트 번호 | HTTP/HTTPS 트래픽 내용 |
| **차단 기준** | "어디서" 오는지 (IP/Port) | "무엇을" 하는지 (공격 패턴) |
| **보호 범위** | 네트워크 전체 | 웹 애플리케이션만 |
| **공격 탐지** | 기본적인 접근 제어 | SQL 인젝션, XSS 등 웹 공격 |

### 예시로 이해하기
```
🏢 건물 보안 비유:
- 방화벽 = 건물 입구 경비원 (신분증만 확인)
- WAF = 각 층별 보안요원 (가방 내용물까지 검사)
```

**방화벽**: "192.168.1.100에서 오는 80포트 접근은 허용"
**WAF**: "이 HTTP 요청에 'SELECT * FROM users' 같은 SQL 구문이 있으니 차단"

## OSI 7계층별 네트워크 보안 솔루션

| 계층 | 보안 솔루션 | 역할 | 처리 방식 | 상세 설명 |
|------|-------------|------|-----------|-----------|
| **L3-L4** | **방화벽(Firewall)** | IP/Port 기반 패킷 필터링 | Inline | "누가" 접근하는지 제어. 신분증 확인하는 경비원 |
| **L3-L4** | **IpSec VPN** | 네트워크 레벨 암호화 터널 | Inline | IP 패킷 자체를 암호화하여 안전한 통신 채널 제공 |
| **L3-L7** | **IDS** | 침입 탐지 시스템 | Out-of-Path | 네트워크부터 애플리케이션까지 모든 계층 트래픽 "탐지"만 수행 |
| **L3-L7** | **IPS** | 침입 방지 시스템 | Inline | 네트워크부터 애플리케이션까지 모든 계층에서 공격 패턴 탐지 시 즉시 "차단" |
| **L5-L7** | **WAF** | 웹 애플리케이션 공격 차단 | Inline/Proxy | "무엇을" 하는지 검사. HTTP 내용물까지 세밀하게 검사 |
| **L5-L7** | **SSL VPN** | 애플리케이션 레벨 암호화 터널 | Inline | HTTPS 기반 보안 원격 접속 제공 |

### 계층별 보안 특징

#### L3-L4 계층 보안 (네트워크/전송 계층)
- **특징**: IP 주소, 포트 번호 기반 제어
- **장점**: 빠른 처리 속도, 단순한 규칙
- **단점**: 내용 기반 공격 탐지 불가
- **예시**: "192.168.1.0/24 네트워크에서 80포트 접근만 허용"

#### L5-L7 계층 보안 (세션/표현/애플리케이션 계층)
- **특징**: 패킷 내용, 프로토콜 데이터 분석
- **장점**: 정교한 공격 탐지 가능
- **단점**: 높은 처리 부하, 복잡한 설정
- **예시**: "HTTP 요청에 SQL 구문 포함 시 차단"

## 보안 장치 배치 방식

### Inline 장치 (인라인 배치)
- **개념**: 네트워크 경로 상에 직접 배치되어 모든 트래픽이 통과
- **특징**:
  - 실시간 차단 가능
  - 트래픽 흐름에 영향 (지연 발생 가능)
  - 장애 시 네트워크 단절 위험
- **비유**: 공기청정기 필터처럼 모든 공기가 통과하며 정화
- **예시**: 방화벽, IPS, WAF

### Out-of-Path 장치 (아웃오브패스 배치)
- **개념**: 네트워크 경로 외부에 배치되어 복사된 트래픽만 분석
- **특징**:
  - 실시간 차단 불가 (탐지만 가능)
  - 트래픽 흐름에 영향 없음
  - 장애 시에도 네트워크 정상 동작
- **방식**: 미러링/센서를 통한 트래픽 복사 분석
- **예시**: IDS(침입 탐지 시스템), 네트워크 모니터링 도구

### IDS vs IPS 차이점
- **IDS**: 침입 **탐지** 후 알림만 제공 (Out-of-Path)
- **IPS**: 침입 **방지** 및 실시간 차단 (Inline)

## 보안 솔루션 간의 관계

### 다중 계층 보안 구조
```
인터넷 → [방화벽] → [IPS] → [WAF] → [웹서버]
          ↓         ↓        ↓
      1차 필터링  2차 정밀탐지  3차 웹특화
```

### 솔루션 간 포함 관계
- **IPS ⊃ IDS**: IPS는 IDS 기능 + 실시간 차단
- **IPS ⊃ 방화벽 기능**: IP/Port 차단 기능 포함
- **IPS ∩ WAF**: 웹 공격 부분에서만 교집합 (완전 포함 관계 아님)

## SSL 인증서 설치 위치

| 설치 위치 | 역할 | 장점 | 단점 |
|-----------|------|------|------|
| **WAS** | 애플리케이션 서버에 직접 설치 | 단순한 구조 | WAS 부하 증가 |
| **Load Balancer** | 로드밸런서에서 SSL 처리 | WAS 부하 분산 | 단일 장애점 |
| **WAF** | 웹 방화벽에서 SSL 종료 | 보안 검사 + SSL 처리 | 복잡한 구조 |
| **IPS** | 침입방지시스템에서 SSL 처리 | 암호화 트래픽 검사 가능 | 성능 오버헤드 |

## DMZ (DeMilitarized Zone)
- **정의**: 비무장 지대, 내부 네트워크와 외부 인터넷 사이의 중간 영역
- **목적**: 외부 접근이 필요한 서버를 내부 네트워크와 분리하여 보안 강화
- **구성**:
  ```
  인터넷 ↔ [외부방화벽] ↔ DMZ(웹서버, 메일서버) ↔ [내부방화벽] ↔ 내부망(DB, 업무서버)
  ```
- **특징**:
  - 외부에서 DMZ 접근 가능
  - DMZ에서 내부망 접근 제한
  - 내부망에서 DMZ 접근 제어


# WAF와 Proxy 구조

## Proxy 서버의 역할
- **정의**: 클라이언트와 서버 사이에서 중계 역할을 하는 대리 서버
- **목적**: 보안, 성능 향상, 캐싱, 로드밸런싱 등

## WAF의 Proxy 구조

### 기본 구조
```
클라이언트 ↔ WAF(Proxy) ↔ 웹서버
   ↓            ↓           ↓
사용자 요청 → 검사/필터링 → 안전한 요청만 전달
```

### DNS 기반 WAF 배치
```
1. 클라이언트가 DNS에 "a.com" 조회
2. DNS가 WAF IP(5.5.5.5) 응답 (실제 서버 IP가 아닌)
3. 클라이언트 → WAF(5.5.5.5) → 실제 웹서버(10.10.10.20)
```

## WAF vs 방화벽/IPS 비교

| 구분 | WAF | 방화벽 | IPS |
|------|-----|--------|-----|
| **HTTPS 처리** | SSL/TLS 복호화 후 검사 | 암호화된 상태로만 검사 | 암호화된 상태로만 검사 |
| **검사 범위** | HTTP 파라미터, 파일 내용 | IP/Port 기반 | 패킷 내용 분석 |
| **배치 방식** | Proxy 구조 | Inline | Inline |
| **공격 탐지** | 애플리케이션 레벨 공격 | 네트워크 접근 제어 | 네트워크/애플리케이션 공격 |

## WAF의 주요 검사 항목
- **파라미터 검증**: SQL 인젝션, XSS 공격 패턴
- **파일 업로드**: 악성 파일, 크기 제한
- **HTTP 헤더**: 비정상적인 헤더 값
- **세션 관리**: 세션 하이재킹, CSRF 공격

## Proxy 구조의 장점
1. **보안 강화**: 실제 서버 IP 숨김
2. **SSL 종료**: WAF에서 암호화 처리 → 서버 부하 감소
3. **트래픽 제어**: 악성 요청 사전 차단
4. **로그 집중화**: 모든 요청이 WAF를 거쳐 로깅

## 실무 배치 예시
```
인터넷 → [DNS: a.com = WAF_IP] → WAF(Proxy) → 내부 웹서버들
                                    ↓
                              SSL 복호화 + 검사
                              + 로드밸런싱
```


# SSL 인증서와 HTTPS 암호화

## SSL 인증서 기본 개념

### SSL 인증서란?
- **정의**: 웹사이트의 신원을 증명하고 암호화 통신을 위한 공개키가 포함된 디지털 증명서
- **역할**:
  1. **신원 확인**: "이 사이트가 진짜 네이버인가?"
  2. **암호화**: 데이터를 안전하게 전송
- **구성**: 공개키 + 도메인 정보 + CA의 디지털 서명

### CA (Certificate Authority)
- **정의**: 인증서를 발급하고 관리하는 신뢰받는 제3기관
- **역할**: SSL 인증서에 디지털 서명하여 위변조 방지
- **예시**: Let's Encrypt, DigiCert, Comodo

## 암호화 방식

### 대칭키 vs 비대칭키
| 구분 | 대칭키 암호화 | 비대칭키 암호화 |
|------|---------------|-----------------|
| **키 개수** | 1개 (동일한 키) | 2개 (공개키 + 개인키) |
| **속도** | 빠름 | 느림 |
| **용도** | 실제 데이터 암호화 | 키 교환, 디지털 서명 |
| **예시** | AES | RSA, ECC |

### HTTPS 암호화 과정
```
1. 클라이언트 → 서버: "HTTPS 연결 요청"
2. 서버 → 클라이언트: "SSL 인증서 전송 (공개키 포함)"
3. 클라이언트: "CA 서명 검증 + 세션키 생성"
4. 클라이언트 → 서버: "공개키로 암호화한 세션키 전송"
5. 이후 통신: "세션키로 대칭 암호화 통신"
```

## 주요 용어 정리

### Session Key (세션키)
- **정의**: 실제 HTTPS 통신에서 사용되는 대칭 암호화 키
- **특징**:
  - 클라이언트가 랜덤 생성
  - 빠른 대칭 암호화 사용
  - 세션마다 새로 생성 (보안 강화)

### PKI (Public Key Infrastructure)
- **정의**: 공개키 기반 암호화 시스템의 전체 구조
- **구성 요소**:
  - **CA**: 인증서 발급 기관
  - **SSL 인증서**: 공개키 + 신원 정보
  - **CRL**: 인증서 폐기 목록

## SSL 인증서 설치 위치별 특징

| 설치 위치 | 장점 | 단점 | 사용 시나리오 |
|-----------|------|------|---------------|
| **웹서버** | 단순한 구조 | 서버 부하 증가 | 소규모 서비스 |
| **로드밸런서** | 서버 부하 분산 | 단일 장애점 | 다중 서버 환경 |
| **WAF** | 보안 검사 + SSL 처리 | 복잡한 구조 | 보안 중시 환경 |

## SSL/TLS Handshake 요약
1. **인증서 검증**: CA 서명으로 서버 신원 확인
2. **키 교환**: 공개키로 세션키 안전 전달
3. **암호화 통신**: 세션키로 빠른 대칭 암호화

## SSL 인증서 검증 과정 상세

### 디지털 서명 검증 메커니즘
```
1. 서버 → 클라이언트: SSL 인증서 전송
2. 클라이언트: 인증서에서 CA 정보 확인
3. 클라이언트: CA의 공개키 획득 (브라우저에 사전 저장)
4. 클라이언트: CA 공개키로 인증서의 디지털 서명 복호화
5. 클라이언트: 인증서 내용의 해시값과 복호화 결과 비교
6. 일치하면 → 인증서 유효성 확인 완료
```

### 검증 단계별 상세
1. **해시 계산**: 클라이언트가 받은 SSL 인증서 내용을 해시 함수로 계산
2. **서명 복호화**: CA의 공개키로 인증서에 포함된 디지털 서명을 복호화
3. **비교 검증**: 계산한 해시값과 복호화한 해시값이 일치하는지 확인
4. **신뢰성 확인**: 일치하면 인증서가 해당 CA에서 발급되었음을 확인

**핵심**: CA의 공개키로 SSL 인증서의 디지털 서명을 복호화하여 무결성 검증
